<div class="content-wrapper">
  <section class="content">
    <ng-container *ngIf="!loading; else load">
      <div class="card mt-3" *ngIf="this.model.url">
        <div class="card-body">
          <h5 class="card-title mb-2">
            <strong>Url para el comprador</strong>
          </h5>
          <div class="input-group" style="display: grid">
            <div class="row">
              <input
                type="text"
                value="{{ this.urlModelPage.split('https://')[1] }}"
                readonly
                class="form-control mb-1"
              />
            </div>

            <div class="row">
              <button
                (click)="this.copyToClipboardUrlModel()"
                class="btn btn-primary"
                type="button"
              >
                Copiar URL
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-3 mb-3">
        <div class="card-header">
          <h5 class="card-title mb-2">
            <strong>Historial de subscripciones</strong>
          </h5>
          <div [hidden]="loading" class="row mb-2">
            <div class="col-12 col-sm-6 col-xl-3 ml-auto">
              <input
                class="form-control"
                placeholder="Buscar"
                (keyup)="applyFilter($event)"
              />
            </div>
          </div>
        </div>
        <ng-container>
          <div class="card-body">
            <div class="mat-table-container">
              <table
                [hidden]="loading"
                mat-table
                matSort
                matSortActive="position"
                matSortDirection="asc"
                [dataSource]="dataSource"
                class="mat-elevation-z8 matTable-table"
                multiTemplateDataRows
              >
                <!-- Position Column -->
                <ng-container matColumnDef="position">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>No.</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.position }}
                  </td>
                </ng-container>

                <!-- Fecha Column -->
                <ng-container matColumnDef="fecha">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    Fecha compra
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.fecha }}
                  </td>
                </ng-container>

                <!-- Estado Column -->
                <ng-container matColumnDef="statusUser">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    Estado de la subscripci√≥n
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.statusUser }}
                  </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let element">
                    <app-button
                      [properties]="this.eyeButton"
                      (click)="
                        expandedElement =
                          expandedElement === element ? null : element
                      "
                    />
                  </td>
                </ng-container>

                <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                <ng-container matColumnDef="expandedDetail">
                  <td
                    mat-cell
                    *matCellDef="let element"
                    [attr.colspan]="displayedColumns.length"
                  >
                    <div
                      class="example-element-detail"
                      [@detailExpand]="
                        element == expandedElement ? 'expanded' : 'collapsed'
                      "
                    >
                      <ul class="pl-0">
                        <li class="py-2">
                          <span class="mx-2 text-muted"></span>
                          <strong class="mat-header-cell"
                            >Estado del pago:</strong
                          >
                          {{ element.modelStatus }}
                        </li>

                        <li class="py-2">
                          <span class="mx-2 text-muted"></span>
                          <strong class="mat-header-cell"
                            >Id del usuario:</strong
                          >
                          {{ element.userId }}
                        </li>

                        <li class="py-2">
                          <span class="mx-2 text-muted"></span>
                          <strong class="mat-header-cell">Precio:</strong>
                          {{ element.price | currency : "USD" }}
                        </li>

                        <li class="py-2">
                          <span class="mx-2 text-muted"></span>
                          <strong class="mat-header-cell"
                            >Fecha de inicio:</strong
                          >
                          {{ element.beginTime }}
                        </li>

                        <li class="py-2">
                          <span class="mx-2 text-muted"></span>
                          <strong class="mat-header-cell">Fecha final:</strong>
                          {{ element.endTime }}
                        </li>
                      </ul>
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let element; columns: displayedColumns"
                  class="example-element-row"
                  [class.example-expanded-row]="expandedElement === element"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: ['expandedDetail']"
                  class="example-detail-row"
                ></tr>
                <!-- Row shown when there is no matching data. -->
                <tr class="mat-row" *matNoDataRow>
                  <td
                    class="mat-cell text-center"
                    [attr.colspan]="displayedColumns.length"
                  >
                    No data matching the filter
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <!-- /.card-body -->
          <div class="card-footer">
            <mat-paginator
              [hidden]="loading"
              [pageSize]="10"
              [pageSizeOptions]="[10, 25, 50, 100]"
              showFirstLastButtons
              aria-label="Select page of periodic elements"
            >
            </mat-paginator>
          </div>
        </ng-container>
        <!-- /.card-footer-->
      </div>

      <div class="card mt-3 mb-3">
        <div class="card-header">
          <h5 class="card-title mb-2">
            <strong>Exportar datos de las subscripciones</strong>
          </h5>
        </div>
        <div class="card-body">
          <ng-container *ngIf="this.subscriptions.length >= 0">
            <button
              class="btn btn-block bg-principal text-white"
              (click)="this.exportarSubscripciones()"
              [disabled]="!(this.subscriptions.length > 0)"
            >
              <i class="fas fa-table"></i> Exportar
            </button>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </section>
</div>

<ng-template #load>
  <app-sk-folding-cube></app-sk-folding-cube>
</ng-template>
