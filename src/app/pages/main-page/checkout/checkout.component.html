<div class="container mt-2">
  <div class="row">
    <div class="col-lg-12 offset-lg-2">
      <div class="card">
        <div class="card-body text-center">
          <h1 class="titulo">
            <strong>Pasarela de pago</strong>
          </h1>
        </div>
      </div>
    </div>
  </div>
  <div class="row mt-2">
    <div class="col-lg-6">
      <div class="card">
        <ng-container *ngIf="!this.load; else loading">
          <div class="card-body">
            <h2 class="text-center mb-3">
              <strong>Detalles de facturaci√≥n</strong>
            </h2>
            <!--nombre-->
            <label for="name"><strong>Nombre</strong></label>
            <p>{{ this.user.name }}</p>

            <!--Correo-->
            <label for="email"><strong>Correo</strong></label>
            <p>{{ this.user.email }}</p>

            <!--Celular-->
            <label for="celphone"><strong>Celular</strong></label>
            <p>{{ this.user.celphone }}</p>

            <!--chatId-->
            <label for="chatId"><strong>Id de Telegram</strong></label>
            <p>{{ this.user.chatId }}</p>
            <button
              (click)="probarConexionBot()"
              class="btn btn-primary btn-block bg-principal mb-2"
              [disabled]="!this.user?.chatId"
              *ngIf="this.user?.chatId"
            >
              Probar conexion con el bot
            </button>
            <div class="alert alert-info" role="alert">
              <small
                >Se le enviara el link de acceso al grupo a este id de
                Telegram</small
              >
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <div class="col-lg-6" *ngIf="!this.hiddenPayMethods()">
      <div class="card">
        <div class="card-body">
          <h2 class="text-center mb-3">
            <strong>Detalles de la compra</strong>
          </h2>
          <div class="ps-block__header d-flex justify-content-between">
            <p><strong>Producto</strong></p>

            <p><strong>Total</strong></p>
          </div>

          <!--Carrito de compras-->
          <ng-container *ngIf="!this.load; else loading">
            <div class="ps-block__content">
              <table class="table ps-block__products">
                <tbody>
                  <tr *ngFor="let cartItem of this.cart; let i = index">
                    <td>
                      <a
                        [routerLink]="[
                          '/grupo/' + this.getUrlModel(cartItem.model!)
                        ]"
                        >{{ cartItem.model?.name }}</a
                      >
                      <p>
                        <strong>Detalle: </strong> <br />
                        {{ cartItem.detalle }}
                      </p>
                    </td>

                    <!--Eliminar-->
                    <td (click)="this.eliminarCartItem(cartItem)">
                      <i class="far fa-trash-alt text-danger"></i>
                    </td>

                    <td class="text-right">
                      {{ cartItem.price | currency : "USD" }}
                    </td>
                  </tr>
                </tbody>
              </table>

              <h3 class="text-right">
                <strong>Total: </strong>
                <span>{{ this.total | currency : "USD" }}</span>
              </h3>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="row mt-2" [hidden]="this.hiddenPayMethods()">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h2 class="text-center mb-3">
              <strong> Metodos de pago </strong>
            </h2>
            <form>
              <ng-container *ngIf="this.findMetodoDePago('paypal')">
                <div class="form-group">
                  <div class="ps-radio">
                    <input
                      class="form-control"
                      type="radio"
                      id="pay-paypal"
                      name="payment-method"
                      value="paypal"
                      checked
                      [(ngModel)]="payMethod"
                    />

                    <label for="pay-paypal"
                      >Pagar con PayPal
                      <span
                        ><img
                          src="../../../../assets/img/payment-method/paypal.jpg"
                          class="w-50" /></span
                    ></label>
                  </div>
                </div>
              </ng-container>

              <div [hidden]="payMethod != 'paypal'" #paypal id="paypal"></div>

              <ng-container *ngIf="this.findMetodoDePago('payu')">
                <div class="form-group">
                  <div class="ps-radio">
                    <input
                      class="form-control"
                      type="radio"
                      id="pay-payu"
                      name="payment-method"
                      value="payu"
                      [(ngModel)]="payMethod"
                    />

                    <label for="pay-payu"
                      >Pagar con PayU, PSE, Nequi, Tarjetas
                      <span
                        ><img
                          src="../../../../assets/img/payment-method/payu.jpg"
                          class="w-50" /></span
                    ></label>
                  </div>
                </div>

                <div class="row" [hidden]="payMethod != 'payu'">
                  <button
                    class="btn btn-primary btn-block bg-payu mb-2"
                    (click)="pagarPayU()"
                  >
                    Pagar con PayU
                  </button>
                </div>
              </ng-container>

              <ng-container *ngIf="this.findMetodoDePago('epayco')">
                <div class="form-group">
                  <div class="ps-radio">
                    <input
                      class="form-control"
                      type="radio"
                      id="pay-epayco"
                      name="payment-method"
                      value="epayco"
                      [(ngModel)]="payMethod"
                    />

                    <label for="pay-epayco"
                      >Pagar con Tarjetas, Paypal, PSE, Nequi
                      <img
                        src="https://epayco.com/wp-content/uploads/2023/01/epayco_pago_seguro.jpg"
                        class="w-100"
                    /></label>
                  </div>
                </div>

                <div class="row" [hidden]="payMethod != 'epayco'">
                  <button
                    style="
                      padding: 0;
                      background: none;
                      border: none;
                      cursor: pointer;
                    "
                    id="epayco-btn"
                    class="epayco-button-render btn btn-block"
                    (click)="this.payEpayco()"
                  >
                    <img
                      src="https://multimedia.epayco.co/dashboard/btns/btn2.png"
                      alt=""
                    />
                  </button>
                </div>
              </ng-container>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <app-sk-folding-cube></app-sk-folding-cube>
</ng-template>
